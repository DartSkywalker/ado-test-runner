<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="Colorlib Templates" name="description">
    <meta content="Colorlib" name="author">
    <meta content="Colorlib Templates" name="keywords">

    <!-- Title Page-->
    <title>{{ test_suite_name }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <!-- Icons font CSS-->
    <link href="//static/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="/static/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="/static/css/main.css" rel="stylesheet" media="all">

</head>
<body>
<nav class="navbar navbar-dark bg-primary navbar-expand-lg">
    <a class="navbar-brand" href="">
        <img src="/static/css/running.svg" width="30" height="30" class="d-inline-block align-top" alt="">
        TRunner</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <ul class="navbar-nav">
        <li class="nav-item active">
            <a class="nav-link" href="/suites">Add Suite<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active">
            <a class="nav-link" href="/suitify">Available Suites<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item active">
            <a class="nav-link" href="/about">About<span class="sr-only">(current)</span></a>
        </li>

    </ul>
    <div class="navbar-collapse collapse  order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active runTest" style="display: none">
                <a class="nav-link border-left" id="runCase" href="">Run Test <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active statistics" style="display: none">
                <a class="nav-link border-right" id="statCase" href="">Statistics<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item active">
                <a class="nav-link">Current Suite - {{ test_suite_name }}<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Hello, {{ username }}
                </a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                    <a class="dropdown-item" href="/settings">Settings</a>
                    <a class="dropdown-item" href="/logout">Logout</a>
                </div>
            </li>
        </ul>
    </div>
</nav>

<div class="container-fluid">

    <table class="table mt-3" style="text-align: center;" id="mt">
        <thead class="bg-primary font-weight-light" style="color: #ffffff;">
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Test Case</th>
            <th scope="col">State</th>
            <th scope="col">Tester</th>
        </tr>
        </thead>
        {% for test_case_id, test_case_data_list in test_cases_dict.items() %}
        <tr class="clickable-row">
            <td class="tcid">
                <a class="text-dark" href="{{ test_case_data_list[1] }}">{{test_case_id}}</a>
            </td>
            <td>
                <p class="text-dark">{{ test_case_data_list[0] }}</p>
            </td>
            <td width="160px" class="testCaseState">
                <p class="text-dark"> {{ test_case_data_list[2] }} </p>
{#                <select class="form-control">#}
{#                    <option selected value="">‚ùï &nbsp;Ready</option>#}
{#                    <option value="1">‚úÖ &nbsp;Passed</option>#}
{#                    <option value="2">‚ùå &nbsp;Failed</option>#}
{#                    <option value="4">üö´ &nbsp;Blocked</option>#}
{#                </select>#}
            </td>
            <td>
                {% if test_case_data_list[3] != None %}
                    <p class="text-dark">{{ test_case_data_list[3] }}</p>
                {% else %}
                <select class="form-control set-user">
                    {% for user_id, user_name in users_dict.items() %}
                    <option value="{{ user_id }}">{{user_name}}</option>
                    {% endfor %}
                </select>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
    <div id="contextMenu" class="dropdown clearfix" style="position: absolute;display: none;">
        <ul class="list-group dropdown-menu" role="menu" aria-labelledby="dropdownMenu"
            style="display:block;position:static;margin-bottom:5px;">
            <li class="list-group-item"><a tabindex="-1" href="#">Run Test Case</a></li>
            <li class="list-group-item"><a tabindex="-1" href="#">Statistics</a></li>
        </ul>
    </div>
</div>
<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>
<script crossorigin="anonymous" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>

</script>
<script>
$(document).ready(function(){
    $(".set-user").on('change', function () {
        toSave = {};
        var userId = $(this).val();
        toSave['userid'] = userId;

        var testCaseId = $(this).closest('tr').find('td.tcid').text().trim();

        let suiteId = window.location.href.substr(window.location.href.lastIndexOf("/")).replace("/","");
        $.ajax({
            url: "/save_user/" + suiteId + "/" + testCaseId,
            data: JSON.stringify(toSave),
            type: 'POST',
            contentType: 'application/json'
        }).done(function(responseData) {
            console.log('Done: ', responseData);
        }).fail(function() {
            console.log('Failed');
        });
    });
});
</script>

<script>
    //Table MB3
    $(function () {

        var $contextMenu = $("#contextMenu");

        $("body").on("contextmenu", "table tr", function (e) {
            $contextMenu.css({
                display: "block",
                left: e.pageX,
                top: e.pageY
            });
            return false;
        });

        $contextMenu.on("click", "a", function () {
            $contextMenu.hide();
        });

    });
</script>
<script>
$('#mt').on('click', '.clickable-row', function(event) {
  if($(this).hasClass('active')){
    $(this).removeClass('active');
    $('.runTest').hide();
    $('.statistics').hide();

  } else {
    $(this).addClass('active').siblings().removeClass('active');
    $('#runCase').attr("href", window.location.href + "/" + $(this).children('td:first-child').text().trim())
    $('#statCase').attr("href", window.location.href + "/" + $(this).children('td:first-child').text().trim() + "/stat")
    $('.runTest').show();
    $('.statistics').show();

  }
});
</script>
</body>
</html>