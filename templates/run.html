<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="Colorlib Templates" name="description">
    <meta content="Colorlib" name="author">
    <meta content="Colorlib Templates" name="keywords">

    <!-- Title Page-->
    <title>{{ test_case_name }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <!-- Icons font CSS-->
    <link href="{{ url_for('static', filename='vendor/mdi-font/css/material-design-iconic-font.min.css') }}" rel="stylesheet" media="all">
    <link href="{{ url_for('static', filename='vendor/font-awesome-4.7/css/font-awesome.min.css') }}" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i"
          rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="{{ url_for('static', filename='vendor/select2/select2.min.css') }}" rel="stylesheet" media="all">
    <link href="{{ url_for('static', filename='vendor/datepicker/daterangepicker.css') }}" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="{{ url_for('static', filename='css/main.css') }}" rel="stylesheet" media="all">

</head>
<body>
<nav class="navbar navbar-dark bg-primary navbar-expand-lg">
    <a class="navbar-brand" href="">
        <img src="{{ url_for('static', filename='css/running.svg') }}" width="30" height="30" class="d-inline-block align-top" alt="">
        TRunner</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <ul class="navbar-nav">
        <li class="nav-item active">
            <a class="nav-link" href="#" id="saveResult">Save<span class="sr-only"></span></a>
        </li>
{#        <li class="nav-item active">#}
{#            <a class="nav-link" href="#" id="saveResultClose">Save and Close<span class="sr-only"></span></a>#}
{#        </li>#}
{#        <li class="nav-item active">#}
{#            <a class="nav-link" href="#">Report a Bug<span class="sr-only"></span></a>#}
{#        </li>#}
    </ul>
    <div class="navbar-collapse collapse  order-3 dual-collapse2">
        <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
                <a class="nav-link" id="backToSuite" href="">Back to Suite<span class="sr-only"></span></a>
            </li>
        </ul>
    </div>
</nav>

<div class="container-fluid">
    <div class="row mt-2 mb-2">
        <div class="col-md-10">{{ test_case_name }}</div>
            <div id='saveSuccess' class="inner success-save" style="display: none">Saved</div>
        <div class="col-md-2">
            <select id="testStatus" class="form-control float-right"
                    style="width:65% ;border: none; border-radius: 0; -webkit-box-shadow: none; box-shadow: none;">
                <option active>üí¨</option>
                <option>‚úÖ &nbsp;Passed</option>
                <option>‚ùå &nbsp;Failed</option>
                <option>üö´ &nbsp;Blocked</option>
                <option>‚è∏ &nbsp;Pause</option>
            </select>
        </div>
    </div>

    <table class="table table-hover" id="tbl1">
        <col width="3%"/>
        <col width="90%"/>
        <col width="5%"/>
        {% for step_data in steps_data_list %}
        <tr class="clickable-row">
            <td>{{ step_data[0] }}</td>
            <td class="step">
                <div>
                {{ step_data[1] | safe }}
                </div>
                <div class="expected">
                {{ step_data[2] | safe }}
                </div>
                <div class style="display: none">
                    <br/><label for="exampleFormControlTextarea1">Comment:</label>
                    <textarea class="form-control comment" id="exampleFormControlTextarea1" rows="3"></textarea>
                </div>
            </td>
            <td class="selector">
                <div class="btn-group btn-group-toggle {{ step_data[3] }}" data-toggle="buttons">
                    <label class="btn btn-passed" id="passed_label">
                        <input type="radio" name="options" id="passed" autocomplete="off" value=""> Passed
                    </label>
                    <label class="btn btn-failed" id="failed_label">
                        <input type="radio" name="options" id="failed" autocomplete="off"> Failed
                    </label>
                </div>
            </td>
        </tr>
        {% endfor %}
    </table>
    <div id="contextMenu" class="dropdown clearfix" style="position: absolute;display: none;">
        <ul class="list-group dropdown-menu" role="menu" aria-labelledby="dropdownMenu"
            style="display:block;position:static;margin-bottom:5px;">
{#            <li class="list-group-item"><a tabindex="-1" href="" id="leaveComment">Leave comment</a></li>#}
            <li class="list-group-item"><button tabindex="-1" id="leaveComment">Leave comment</button></li>
        </ul>
    </div>

</div>
<script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script crossorigin="anonymous" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


<script>
    $('#tbl1 tr').each(function (index) {
        $(this).find('.selector').each(function () {
            $(this).find('div.btn-group-toggle').each(function () {
                if ($(this).hasClass('Failed')) {
                    $(this).find('input[id="failed"]').each(function(){
                        $(this).attr("checked", "checked")
                     });
                } else if ($(this).hasClass('Passed')){
                    $(this).find('input[id="passed"]').each(function(){
                        $(this).attr("checked", "checked")
                     });
                }
            })
        })
    })

</script>
<script>
$('td.step').on('dblclick', function() {
    $(this).find('div:nth-child(3)').css('display', 'block')
});
</script>
<script>
    $('#backToSuite').attr("href", window.location.href.substr(0,
        window.location.href.lastIndexOf("/"))
        .replace("run", "cases"))
</script>
<script>
    $("#saveResult").click(function () {
        testResults = {};
        testCaseOutcomeDirty = $('#testStatus').val();
        if (testCaseOutcomeDirty.indexOf("Passed") >= 0) {
            testCaseOutcome = 'Passed';
        } else if (testCaseOutcomeDirty.indexOf("Failed") >= 0) {
            testCaseOutcome = 'Failed';
        } else if (testCaseOutcomeDirty.indexOf("Blocked") >= 0) {
            testCaseOutcome = 'Blocked';
        } else if (testCaseOutcomeDirty.indexOf("Pause") >= 0) {
            testCaseOutcome = 'Pause';
        }

        testResults['testResult'] = {outcome: testCaseOutcome};
        $('#tbl1 tr').each(function (index) {
        var comment = ""
            $(this).find('.comment').each(function () {
                if ($(this).val().length !== 0) {
                    comment = $(this).val();
                }
            })
            $(this).find('#passed_label').each(function () {
                if ($(this).hasClass('active')) {
                    testResults[index] = {stepNum: index + 1, outcome: 'Passed', comment: comment}
                }
            })
            $(this).find('#failed_label').each(function () {
                if ($(this).hasClass('active')) {
                    testResults[index] = {stepNum: index + 1, outcome: 'Failed', comment: comment}
                }
            })

        })

        let testCaseId = window.location.href.substr(window.location.href.lastIndexOf("/")).replace("/","")
        $.ajax("/save_test_result/" + testCaseId, {
            data: JSON.stringify(testResults),
            contentType: 'application/json',
            type: 'POST',
            success: function () {
                $("#saveSuccess").css('display', 'flex')
                $("#saveSuccess").fadeOut(3000)
            }
        })

    })
</script>
<script>
        $("#saveResultClose").click(function () {
        testResults = {};
        testCaseOutcomeDirty = $('#testStatus').val();
        if (testCaseOutcomeDirty.indexOf("Passed") >= 0) {
            testCaseOutcome = 'Passed';
        } else if (testCaseOutcomeDirty.indexOf("Failed") >= 0) {
            testCaseOutcome = 'Failed';
        } else if (testCaseOutcomeDirty.indexOf("Blocked") >= 0) {
            testCaseOutcome = 'Blocked';
        } else if (testCaseOutcomeDirty.indexOf("Pause") >= 0) {
            testCaseOutcome = 'Pause';
        }

        testResults['testResult'] = {outcome: testCaseOutcome};
        $('#tbl1 tr').each(function (index) {
        var comment = ""
            $(this).find('.comment').each(function () {
                if ($(this).val().length !== 0) {
                    comment = $(this).val();
                }
            })
            $(this).find('#passed_label').each(function () {
                if ($(this).hasClass('active')) {
                    testResults[index] = {stepNum: index + 1, outcome: 'Passed', comment: comment}
                }
            })
            $(this).find('#failed_label').each(function () {
                if ($(this).hasClass('active')) {
                    testResults[index] = {stepNum: index + 1, outcome: 'Failed', comment: comment}
                }
            })

        })

        let testCaseId = window.location.href.substr(window.location.href.lastIndexOf("/")).replace("/","")
        $.ajax("/save_test_result/" + testCaseId, {
            data: JSON.stringify(testResults),
            contentType: 'application/json',
            type: 'POST',
            success: function () {
                var popup = window.open("", "my-popup");
popup.close()
            }
        })

    })
</script>

</body>
</html>